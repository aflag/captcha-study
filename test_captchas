#!/usr/bin/python
from subprocess import Popen, PIPE
annotations={
'datasets/annotated_captchas/captcha0.jpg':'3328',
'datasets/annotated_captchas/captcha1.jpg':'2396',
'datasets/annotated_captchas/captcha2.jpg':'1303',
'datasets/annotated_captchas/captcha3.jpg':'8433',
'datasets/annotated_captchas/captcha4.jpg':'0568',
'datasets/annotated_captchas/captcha5.jpg':'5881',
'datasets/annotated_captchas/captcha6.jpg':'2499',
'datasets/annotated_captchas/captcha7.jpg':'4409',
'datasets/annotated_captchas/captcha8.jpg':'6880',
'datasets/annotated_captchas/captcha9.jpg':'4981',
'datasets/annotated_captchas/captcha10.jpg':'1982',
'datasets/annotated_captchas/captcha11.jpg':'6218',
'datasets/annotated_captchas/captcha12.jpg':'3269',
'datasets/annotated_captchas/captcha13.jpg':'5693',
'datasets/annotated_captchas/captcha14.jpg':'0066',
'datasets/annotated_captchas/captcha15.jpg':'9301',
'datasets/annotated_captchas/captcha16.jpg':'5605',
'datasets/annotated_captchas/captcha17.jpg':'2998',
'datasets/annotated_captchas/captcha18.jpg':'2684',
'datasets/annotated_captchas/captcha19.jpg':'0884',
'datasets/annotated_captchas/captcha20.jpg':'3209',
'datasets/annotated_captchas/captcha21.jpg':'3106',
'datasets/annotated_captchas/captcha22.jpg':'1005',
'datasets/annotated_captchas/captcha23.jpg':'6168',
'datasets/annotated_captchas/captcha24.jpg':'1184',
'datasets/annotated_captchas/captcha25.jpg':'2656',
'datasets/annotated_captchas/captcha26.jpg':'2925',
'datasets/annotated_captchas/captcha27.jpg':'5842',
'datasets/annotated_captchas/captcha28.jpg':'1165',
'datasets/annotated_captchas/captcha29.jpg':'5830',
'datasets/annotated_captchas/captcha30.jpg':'4013',
'datasets/annotated_captchas/captcha31.jpg':'6660',
'datasets/annotated_captchas/captcha32.jpg':'5504',
'datasets/annotated_captchas/captcha33.jpg':'5159',
'datasets/annotated_captchas/captcha34.jpg':'1989',
'datasets/annotated_captchas/captcha35.jpg':'6283',
'datasets/annotated_captchas/captcha36.jpg':'1314',
'datasets/annotated_captchas/captcha37.jpg':'9634',
'datasets/annotated_captchas/captcha38.jpg':'9128',
'datasets/annotated_captchas/captcha39.jpg':'1006',
'datasets/annotated_captchas/captcha40.jpg':'4864',
'datasets/annotated_captchas/captcha41.jpg':'4368',
'datasets/annotated_captchas/captcha42.jpg':'2924',
'datasets/annotated_captchas/captcha43.jpg':'5496',
'datasets/annotated_captchas/captcha44.jpg':'4235',
'datasets/annotated_captchas/captcha45.jpg':'5441',
'datasets/annotated_captchas/captcha46.jpg':'5920',
'datasets/annotated_captchas/captcha47.jpg':'8835',
'datasets/annotated_captchas/captcha48.jpg':'1910',
'datasets/annotated_captchas/captcha49.jpg':'5533',
'datasets/annotated_captchas/captcha50.jpg':'1322',
'datasets/annotated_captchas/captcha51.jpg':'6882',
'datasets/annotated_captchas/captcha52.jpg':'0398',
'datasets/annotated_captchas/captcha53.jpg':'5002',
'datasets/annotated_captchas/captcha54.jpg':'0253',
'datasets/annotated_captchas/captcha55.jpg':'1311',
'datasets/annotated_captchas/captcha56.jpg':'0261',
'datasets/annotated_captchas/captcha57.jpg':'4896',
'datasets/annotated_captchas/captcha58.jpg':'6488',
'datasets/annotated_captchas/captcha59.jpg':'1513',
'datasets/annotated_captchas/captcha60.jpg':'6038',
'datasets/annotated_captchas/captcha61.jpg':'2692',
'datasets/annotated_captchas/captcha62.jpg':'5813',
'datasets/annotated_captchas/captcha63.jpg':'0233',
'datasets/annotated_captchas/captcha64.jpg':'0644',
'datasets/annotated_captchas/captcha65.jpg':'4229',
'datasets/annotated_captchas/captcha66.jpg':'3408',
'datasets/annotated_captchas/captcha67.jpg':'4302',
'datasets/annotated_captchas/captcha68.jpg':'3533',
'datasets/annotated_captchas/captcha69.jpg':'0405',
'datasets/annotated_captchas/captcha70.jpg':'6122',
'datasets/annotated_captchas/captcha71.jpg':'2390',
'datasets/annotated_captchas/captcha72.jpg':'0565',
'datasets/annotated_captchas/captcha73.jpg':'9228',
'datasets/annotated_captchas/captcha74.jpg':'9615',
'datasets/annotated_captchas/captcha75.jpg':'0043',
'datasets/annotated_captchas/captcha76.jpg':'5855',
'datasets/annotated_captchas/captcha77.jpg':'1986',
'datasets/annotated_captchas/captcha78.jpg':'4228',
'datasets/annotated_captchas/captcha79.jpg':'3304',
'datasets/annotated_captchas/captcha80.jpg':'3959',
'datasets/annotated_captchas/captcha81.jpg':'1014',
'datasets/annotated_captchas/captcha82.jpg':'5509',
'datasets/annotated_captchas/captcha83.jpg':'3135',
'datasets/annotated_captchas/captcha84.jpg':'1444',
'datasets/annotated_captchas/captcha85.jpg':'9911',
'datasets/annotated_captchas/captcha86.jpg':'9862',
'datasets/annotated_captchas/captcha87.jpg':'0360',
'datasets/annotated_captchas/captcha88.jpg':'1812',
'datasets/annotated_captchas/captcha89.jpg':'0152',
'datasets/annotated_captchas/captcha90.jpg':'0982',
'datasets/annotated_captchas/captcha91.jpg':'1134',
'datasets/annotated_captchas/captcha92.jpg':'8596',
'datasets/annotated_captchas/captcha93.jpg':'0049',
'datasets/annotated_captchas/captcha94.jpg':'2094',
'datasets/annotated_captchas/captcha95.jpg':'0960',
'datasets/annotated_captchas/captcha96.jpg':'0824',
'datasets/annotated_captchas/captcha97.jpg':'6311',
'datasets/annotated_captchas/captcha98.jpg':'3616',
'datasets/annotated_captchas/captcha99.jpg':'0635',
'datasets/annotated_captchas/captcha100.jpg':'9401',
'datasets/annotated_captchas/captcha101.jpg':'9291',
'datasets/annotated_captchas/captcha102.jpg':'5924',
'datasets/annotated_captchas/captcha103.jpg':'5232',
'datasets/annotated_captchas/captcha104.jpg':'9886',
'datasets/annotated_captchas/captcha105.jpg':'3244',
'datasets/annotated_captchas/captcha106.jpg':'6920',
'datasets/annotated_captchas/captcha107.jpg':'8694'}

values = ''
for key,value in sorted(annotations.items()):
    values += key + '\n'

process = Popen(['./break_captcha', 'model/saved'], stdout=PIPE, stdin=PIPE)
stdout, stderr = process.communicate(values)
values = stdout.split()
matches = 0
for i,item in enumerate(sorted(annotations.items())):
    if values[i] == item[1]:
        matches += 1
print float(matches)/len(annotations)
